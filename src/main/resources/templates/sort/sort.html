<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <div th:replace="commons/head::head"></div>
    <!-- 引入 echarts.js -->
    <script th:src="@{/images/echarts.min.js}" type="text/javascript"></script>

    <!--    <script src="./js/echarts.min.js"></script>-->
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="main" style="width: 900px;height: 600px;"></div>

<script>
    new Vue({
        el: '#main',
        data: {
            temp: 0,
            data: [],
            option: {
                // 标题
                title: {
                    text: 'ECharts 入门示例',
                    subtext: 'Bravery',
                    left: 'left',
                    borderColor: 'red',
                    borderWidth: 3
                },
                // 工具箱
                toolbox: {
                    show: true,
                    feature: {
                        saveAsImage: {
                            show: true
                        },
                        restore: {
                            show: true
                        },
                        dataView: {
                            show: true
                        },
                        dataZoom: {
                            show: true
                        },
                        magicType: {
                            type: ['line', 'bar']
                        }

                    }
                },
                tooltip: {
                    trigger: 'axis'
                },
                // 图例
                legend: {
                    data: ['销量']
                },
                // x轴
                xAxis: {
                    data: ["衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"]
                },
                yAxis: {},
                // 数据
                series: [{
                    name: '销量',
                    type: 'bar',
                    data: [5, 20, 18, 48, 10, 20],
                    markPoint: {
                        data: [
                            {type: 'max', name: '最大值'},
                            {type: 'min', name: '最小值', symbol: 'arrow'}
                        ]
                    },
                    markLine: {
                        data: [
                            {type: 'average', name: '平均值'}
                        ]
                    }
                }
                ]
            }
        },
        mounted: function () {
            this.getData();
            if (this.timer) {
                clearInterval(this.timer);
            } else {
                this.timer = setInterval(() => {
                    this.getData();
                }, 500);
            }
        },
        watch: {
            //观察option的变化
            option: {
                handler(newVal, oldVal) {
                    if (this.chart) {
                        if (newVal) {
                            this.chart.setOption(this.option);
                        } else {
                            console.log(123)
                            this.chart.setOption(oldVal);
                        }
                    } else {
                        this.init();
                    }
                },
                deep: true //对象内部属性的监听，关键。
            }
        },
        methods: {
            getData: function () {
                var arr = [20, 18, 27, 19, 35];
                this.chart = echarts.init(document.getElementById("main"));
                this.chart.setOption(this.option);
                this.chart = echarts.init(document.getElementById("main"));
                this.$http.get("/date", {}).then(function (responce) {
                    var res = responce.data;
                    if (res.code == 1000) {
                        this.option.series = res.data.series;



                        this.option.xAxis=res.data.xaxis;
                        console.log(this.option.series.data)
                        // 指定图表的配置项和数据
                        this.chart.setOption(this.option);

                    }
                })
            },
        },
    })
</script>

</body>
</html>